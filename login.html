<!DOCTYPE HTML>
<!--
	Spatial by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
	<head>
		<title>Green Dot Corp Login</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="landing">

		<!-- Header -->
			<header id="header">
				<!-- <h1><strong><a href="index.html">Spatial</a></strong> by Templated</h1> -->
				<a href="index.html"><img src="images/logo.png" style="height: 100%"/></a>
				<nav id="nav">
					<ul>
						<li><a href="profile.html">My Profile</a></li>
						<li><a href="login.html" class="button">Login/Open an Account</a></li> 
					</ul>
				</nav>
			</header>

			<a href="#menu" class="navPanelToggle"><span class="fa fa-bars"></span></a>

		<!-- Banner -->
			<section id="banner">
				<!-- <ul class="actions">
					<li><a href="#" class="button big">Start Saving</a></li> -->
					<!-- make button kickoff Auth-code flow -->
				<!-- </ul> -->
				<!-- <ul class="actions">
					<form name="loginform" id="loginform" action="#" method="post">
              <p class="login-username">
								<label for="user_login">Username</label>
                <input type="text" name="log" id="user_login" class="input" value="" size="20" />
              </p>
              <p class="login-password">
                <label for="user_pass">Password</label>
                <input type="password" name="pwd" id="user_pass" class="input" value="" size="20" />
			</p> -->
			</section>
			<!-- Hidden Divs for URLs -->
			<div class="mfn-login" style="display: none;">
				<input type="text" class="form-control" name="validatePasswordUrl" id="validatePasswordUrl" readonly />
			</div>
		  	<!-- <div class="mfn-login" style="display: none;">
			  <input type="text" class="form-control" name="registration.external" id="registerUserUrl" readonly />
		  	</div> -->
		  	<div class="mfn-login" style="display: none;">
				<input type="text" class="form-control" name="forgotPasswordURL" id="forgotPasswordURL" readonly />
		  	</div>
		  	<div class="mfn-login" style="display: none;">
			  	<input type="text" class="form-control" name="socialLoginUrl0" id="socialLoginUrl0" readonly />
				<input type="text" class="form-control" name="socialLoginUrl1" id="socialLoginUrl1" readonly />
		  	</div>
			<!-- end hidden divs -->
			

			<section id = "loginDiv" class = "wrapper">
				<div id = "loginDiv" class="container">
					<form method="post" action="#">
						<div class="row uniform 50%">
							<div class="6u$ 12u$(xsmall)">
								<input type="text" name="user_login" id="user_login" value="" placeholder="Username" />
							</div>
							<div class="6u$ 12u$(xsmall)">
								<input type="password" name="user_pass" id="user_pass" value="" placeholder="Password" />
							</div>
						</div>
					</form>
				<!-- </div> -->
				<div id = "warningDiv" class="container">
					<form method="post" action="#">
						<div class="row uniform 50%">
							<span style="color:red" id="warningMessage" class="confirm-message"></span>
						</div>
					</form>
				</div>
			<br/>
			<!-- <div id = "loginDiv" class="row center" style="margin:auto"> -->
			<p class="login-submit">
				<div class = "12u center" style="margin:auto">
					<a class="button button_theme" onclick="pwned('START');" >LogIn</a>
					<!--<a class="button button_theme" onclick="validatePassword();" >Login</a>-->
					<input type="hidden" name="redirect_to" value="#" />
						<a class="button button_theme" onclick="resetPassword('user');">Trouble logging in?</a>
					<input type="hidden" name="redirect_to" value="#" />
						<a class="button button_theme" onclick="redirect_toReg();">Open An Account</a>
				</div>
				<div class = "12u center" style="margin:auto; padding-top: 5px;">
					<input type="hidden" name="redirect_to" value="#" />
					<a class="button button_theme" style="visibility: hidden;" id =socialButton0 onclick="redirect_toSocial('0');"><i class="fab fa-google"></i></a>
					<input type="hidden" name="redirect_to" value="#" />
					<a class="button button_theme" style="visibility: hidden;" id =socialButton1 onclick="redirect_toSocial('1');"><i class="fab fa-facebook"></i></a>
				</div>
				
			</p>
			</div>
		</section>
		<section id = "pwResetCodeDiv" class= "wrapper">
			<div class="container">
					<form method="post" action="#">
						<!-- <div class="row uniform 50%"> -->
							<div class="6u$ 12u$(xsmall)" style= "padding-bottom: 10px">
								<input type="password" style="width: 200px;" name="pwReset_Code" id="pwReset_Code" value="" placeholder="One Time Passcode" />
							</div>
							<div class="6u$ 12u$(xsmall)" style= "padding-bottom: 10px">
								<input type="password" name="new_password" id="new_password" value="" placeholder="Password" />
							</div>
							<div id = "warningDiv" class="container">
								<form method="post" action="#">
									<div class="row uniform 50%">
										<span style="color:red" id="warningMessage" class="confirm-message"></span>
									</div>
									<div class="6u 12u$(xsmall)">
										<span id="pwnedWarning" class="confirm-message"></span>
									</div>
								</form>
							</div>
							<div id = "pwResetCodeDiv">
								<p class="login-submit">
									<a id=resetpwdbutton class="button button_theme" onclick="validatePWResetCode();">Set Password</a>
										<input type="hidden" name="redirect_to" value="#" />
								</p>
							</div>
						<!-- </div> -->
					</form>
				</div>
			<br/>

		</section>
		<section id = "idfirst" class= "wrapper">
			<div class="row center" style="margin:auto">
				<p class="login-submit">
					<div class="6u$ 12u$(xsmall)">
						<input type="text" name="userid" id="userid" value="" placeholder="Username" />
					</div>
					<ul class="actions">
						<li><a href="#" class="button" onclick="userLookup();">Continue</a></li> 
					</ul>
					<!-- Hidden Divs for URLs -->
					<div class="mfn-login" style="display: none;">
						<input type="text" class="form-control" name="userlookup" id="userlookup" readonly />
					</div>
		</section>

		<section id = "changePasswordDiv" class= "wrapper">
			<!-- Hidden Divs for URLs -->
			<div class="mfn-login" style="display: none;">
				<input type="text" class="form-control" name="changePasswordUrl" id="changePasswordUrl" readonly />
			</div>
			<div class="container"></div>
					<form method="post" action="#">
						<!-- <div class="row uniform 50%"> -->
							<div class="6u 12u$(xsmall)">
								<input type="password" name="current_password" id="current_password" value="" placeholder="Current Password" />
							</div>
							<div class="6u$ 12u$(xsmall)">
								<input type="password" name="change_new_password" id="change_new_password" value="" placeholder="New Password" />
							</div>
						<!-- </div> -->
					</form>
			<br/>
				<p class="login-submit">
					<a class="button button_theme" onclick="changePassword();">Change Password</a>
						<input type="hidden" name="redirect_to" value="#" />
				</p>
			</div>
				<div class="row uniform 50%">
					<span style="color:red" id="warningMessage" class="confirm-message"></span>
				</div>
		</section>

		<section>
			<div class="mfn-login" style="display: none;">
				<input type="text" class="form-control" name="ppURL" id="ppURL" readonly />
			</div>
			<div id="ppDiv" class = "container">
				<h4 id="prompt"> </h4>
				<div class="6u$ 12u$(xsmall)">
					<input type="hidden" class="form-control" name="labelID1" id="labelID1" readonly />
					<label id =label1 style="display:inline-block;"></label>
					<input type="text" name="value1" id="value1" value="" />
					<!-- <div class="mfn-login" style="display: none;">
						<input type="text" class="form-control" name="label1ID" id="label1ID" readonly />
					</div> -->
				</div>
				<div class="6u$ 12u$(xsmall)">
					<input type="hidden" class="form-control" name="labelID2" id="labelID2" readonly />
					<label id =label2 style="display:inline-block;"></label>
					<input type="text" name="value2" id="value2" value="" />
					<!-- <div class="mfn-login" style="display: none;">
						<input type="text" class="form-control" name="label2ID" id="label2ID" readonly />
					</div> -->
				</div>
				<div class="row uniform 50%">
					<span style="color:red" id="warningMessage" class="confirm-message"></span>
				</div>
				<ul class="actions">
					<li><a href="#" class="button" onclick="setPPValues();">Continue</a></li> 
				</ul>
			</div>
			<div id ="pushDiv" view="hide" class="row uniform 50%">
				<h2> Push Sent </h2>
				<div class="mfn-login" style="display: none;">
					<input type="text" class="form-control" name="pushResumeUrl" id="pushResumeUrl" readonly />
				</div>
				<span id="confirm-message2" class="confirm-message"></span>
				<ul class="actions">
					<li><a href="#" class="button" onclick="continue_push();">Continue</a></li> 
				</ul>
				
			</div>
			<div id ="otpDiv" view="hide" class="row uniform 50%">
				<h2> Enter your OTP </h2>
				<div class="6u 12u$(xsmall)">
					<input type="text" name="otp_login" id="otp_login" value="OTP" />
				</div>
				<div class="mfn-login" style="display: none;">
					<input type="text" class="form-control" name="validateOtpUrl" id="validateOtpUrl" readonly />
				</div>
				<span id="confirm-message2" class="confirm-message"></span>
				<ul class="actions">
					<li><a href="#" class="button" onclick="validateOTP();">Continue</a></li> 
				</ul>
				<div class="row uniform 50%">
					<span style="color:red" id="warningMessage" class="confirm-message"></span>
				</div>
				
			</div>

		</section> 

		<!-- Footer -->
		<footer id="footer">
			<div class="container">
				<ul class="icons">
					<li><a href="#" class="icon fa-facebook"></a></li>
					<li><a href="#" class="icon fa-twitter"></a></li>
					<li><a href="#" class="icon fa-instagram"></a></li>
				</ul>
				<ul class="copyright">
					<li>Green Dot Corp</li>
				</ul>
			</div>
		</footer>

		<!-- Scripts -->
			<script src="assets/js/p1helper.js"></script>
			<script src="assets/js/p1Logon.js"></script>
			<script src="assets/js/pwned.js"></script>
			<script src="assets/js/p1.js"></script>

			
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
			<script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" data-auto-replace-svg="nest"></script>
			


			<script>
// some housekeeping variables

				$('#changePassword').on('input', function (e) {
				let thisPassword = $('#changePassword').val();

				if (regexLower.test(thisPassword)) {
				$('#lowercase').removeClass('text-primary');
				} else {
					$('#lowercase').addClass('text-primary');
				}
				if (regexUpper.test(thisPassword)) {
					$('#uppercase').removeClass('text-primary');
				} else {
					$('#uppercase').addClass('text-primary');
				}

				if (regexNumeric.test(thisPassword)) {
					$('#numeric').removeClass('text-primary');
				} else {
					$('#numeric').addClass('text-primary');
				}

				if (regexSpecial.test(thisPassword)) {
					$('#special').removeClass('text-primary');
				} else {
					$('#special').addClass('text-primary');
				}

				if (regexLength.test(thisPassword)) {
					$('#length').removeClass('text-primary');
				} else {
					$('#length').addClass('text-primary');
				}
			});
			// begin process
			$(document).ready(function () {
				console.log("Page ready function");

				// do I already have a session cookie?

			// 	if (Cookies.get('accessToken') && Cookies.get('idToken')) {
			// 		// yes, user already has a session

			// 		console.log('id_token (' + Cookies.get('idToken') + ')');
			// 		console.log('accessToken (' + Cookies.get('accessToken') + ')');


			// 	} else {
			// 			initiateLogon();
			// 		}

			// })


			if (Cookies.get('accessToken') && Cookies.get('idToken')) {
            // yes, user already has a session
            console.log('id_token (' + Cookies.get('idToken') + ')');
			console.log('accessToken (' + Cookies.get('accessToken') + ')');
			window.location.replace(baseUrl+'/profile.html');


          } else {

              // missing accessToken or idToken for this individual

              console.log('No existing user session or token found');
			  // was the user just sent here from p14c?
			  getUrlParameter();
              console.log("flowid value: "+flowId);
              if (flowId) {

                // url has a flowId - so they just arrived from p14c

                console.log('flowId found in url: ' + flowId);
                console.log('User already bootstrapped through p14c');
				console.log('Performing p14c ajax query to determine next step');
				getNextStep(flowId);

              } else {

                // url does not have a flowId.  and we don't have a session.  send them authorizationUrl
                console.log('No flowId found in url');
                console.log('Redirecting to p14c to bootstrap session');
                window.location.replace(authorizationUrl);

              }

			}
		})
		const pwnedPasss = document.getElementById("new_password");

		pwnedPasss.addEventListener(	
			"keyup",
			debounce(resetPwned,500)
		);
		// const myInput = document.getElementById("user_pass");

		// myInput.addEventListener(	
    	// 	"keyup",
    	// 	debounce( pwned, 2000 )
		// );
		
	</script>

	</body>
</html>
